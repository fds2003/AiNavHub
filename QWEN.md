# Qwen 开发指南

## 开发哲学

### 核心信念
- **渐进改进胜过一次性大改**：保持小而可控的修改，确保能编译并通过测试。
- **从现有代码中学习**：在实现前先研究和规划，避免重复造轮子。
- **务实优先于教条**：根据项目实际情况灵活调整。
- **清晰意图优于炫技代码**：代码要直白易懂。

### 简单意味着
- 每个函数/类只承担单一职责。
- 避免过早抽象。
- 不搞复杂技巧——选择最朴素的方案。
- 如果需要特别解释，说明设计过于复杂。

## 开发流程

### 1. 规划与分解
将复杂任务拆分为 3-5 个阶段，记录到 `IMPLEMENTATION_PLAN.md` 中：

```markdown
## 阶段 N: [名称]
**目标**: [具体可交付物]
**成功标准**: [可测试结果]
**测试**: [对应测试用例]
**状态**: [未开始|进行中|已完成]
```
- 随进度更新状态
- 全部完成后移除该文件

### 2. 实现步骤
1. **理解** —— 学习代码库中已有模式
2. **测试** —— 先写失败测试（red）
3. **实现** —— 最少代码使其通过（green）
4. **重构** —— 在测试通过前提下清理代码
5. **提交** —— 使用清晰的提交信息，并关联计划

### 3. 卡住时（最多 3 次尝试）
> **关键**：最多尝试 3 次，否则必须停下来。

1. **记录失败情况**：
   - 尝试过的方法
   - 具体报错
   - 失败原因推测

2. **研究替代方案**：
   - 找到 2-3 个类似实现
   - 记录不同思路

3. **质疑基础假设**：
   - 抽象层次是否合适？
   - 能否进一步拆分？
   - 有没有更简单的思路？

4. **换个角度尝试**：
   - 使用 Qoder 的不同提示模式或 API
   - 尝试不同架构方式
   - 移除抽象而非增加抽象

## 技术标准

### 架构原则
- **组合优于继承** —— 使用依赖注入。
- **接口优于单例** —— 保证可测试性和灵活性。
- **显式优于隐式** —— 保持清晰的数据流和依赖关系。
- **尽量测试驱动** —— 永远不要禁用测试。

### 代码质量
- **每次提交必须**：
  - 成功编译
  - 通过所有测试
  - 为新增功能添加测试
  - 遵循项目格式/代码规范

- **提交前**：
  - 运行格式化/静态检查
  - 自检修改内容
  - 确认提交信息解释“为什么”

### 错误处理
- 尽快失败，并给出清晰错误信息
- 提供足够上下文以便调试
- 在适当层级处理错误
- 不要静默吞掉异常

## 决策框架
遇到多种可行方案时，按以下顺序决策：
1. **可测试性** —— 是否容易测试？
2. **可读性** —— 半年后别人能否快速理解？
3. **一致性** —— 是否符合项目现有模式？
4. **简洁性** —— 是否是能工作的最简单方案？
5. **可逆性** —— 修改难度有多大？

## 项目集成

### 熟悉代码库
- 找到 3 个类似功能/组件
- 确定常见模式与约定
- 尽量使用现有工具库
- 遵循已有测试模式

### 工具使用
- 使用项目的构建系统
- 使用项目测试框架
- 使用既定格式化/静态检查配置
- 没有充分理由不要引入新工具

## 质量关卡

### 完成定义
- [ ] 测试已编写且通过
- [ ] 代码遵循项目约定
- [ ] 无格式/静态检查警告
- [ ] 提交信息清晰
- [ ] 实现符合规划
- [ ] 没有未标注 issue 的 TODO

### 测试准则
- 测试行为，而非实现细节
- 尽量每个测试只有一个断言
- 测试名清晰描述场景
- 使用现有测试工具/辅助方法
- 测试必须具备确定性

## 重要提醒

**禁止**：
- 使用 `--no-verify` 绕过提交检查
- 禁用测试而不是修复
- 提交无法编译的代码
- 不经验证就做假设

**必须**：
- 持续提交可工作的代码
- 按进度更新计划文档
- 学习并参考现有实现
- 连续失败 3 次后停下来重新评估

